// import posts list
const connection = require('../db/connection');

// import middleware functions
const errorsHandlerMiddleware = require('../middlewares/errorsHandler');
const notFoundMiddleware = require('../middlewares/notFound');

// Create INDEX route function

const index = (req, res) => {
    const sql = 'SELECT * FROM posts';
    connection.query(sql, (err, results)=>{
        if (err) {
            errorsHandlerMiddleware();
        };
        console.log(results);
        res.json(results);
    });
};

// Create SHOW route function

const show = (req, res) => {
    console.log(req.params);
    console.log(typeof req.params.id);
    const id = parseInt(req.params.id);
    console.log(`Here's the pizza number ${id}`);
    const sql = 'SELECT * FROM posts WHERE id = ?;';
    console.log(sql);
    connection.query(sql, [id], (err, results)=>{
        if(err) {
            errorsHandlerMiddleware;
        };
        if (!results.length > 0) {
        return res.status(404).json({
            error: true,
            message: 'Not Found'
            });
        };
        console.log(results);
        return res.json(results[0]);
    });
};

module.exports = {
    index,
    show
};